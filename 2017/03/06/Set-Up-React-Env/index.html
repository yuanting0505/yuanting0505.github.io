<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns#">

<head>
  <meta charset="UTF-8" >
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <title>从零开始学习React: 使用Yarn, Webpack和Babel来搭建环境 | Jasmine Yuan&#39;s Home</title>
  <meta name="description" content="" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="序言最近我开始学习炙手可热的React，在浏览了官网的Get Started部分之后，我想动手写一写代码，这才发现官网并没有给出详细的环境搭建过程，而且我并不想使用官网提供的 boilerplate 项目Create React App。因此，我把这个过程记录下来，希望可以给新手们一点帮忙，这里并不介绍React相关的基础知识，只介绍环境的搭建过程。来，让我们从零开始，跟着贾思敏姐姐一步步搭建一个">
<meta property="og:type" content="article">
<meta property="og:title" content="从零开始学习React: 使用Yarn, Webpack和Babel来搭建环境">
<meta property="og:url" content="jasmineyuan.com/2017/03/06/Set-Up-React-Env/index.html">
<meta property="og:site_name" content="Jasmine Yuan's Home">
<meta property="og:description" content="序言最近我开始学习炙手可热的React，在浏览了官网的Get Started部分之后，我想动手写一写代码，这才发现官网并没有给出详细的环境搭建过程，而且我并不想使用官网提供的 boilerplate 项目Create React App。因此，我把这个过程记录下来，希望可以给新手们一点帮忙，这里并不介绍React相关的基础知识，只介绍环境的搭建过程。来，让我们从零开始，跟着贾思敏姐姐一步步搭建一个">
<meta property="og:image" content="https://s1.ax1x.com/2018/11/22/FPPChd.png">
<meta property="og:image" content="https://s1.ax1x.com/2018/11/22/FPCHh9.png">
<meta property="og:image" content="https://s1.ax1x.com/2018/11/22/FPCTk4.png">
<meta property="og:image" content="https://s1.ax1x.com/2018/11/22/FPCI7F.png">
<meta property="og:updated_time" content="2018-11-21T18:32:41.403Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="从零开始学习React: 使用Yarn, Webpack和Babel来搭建环境">
<meta name="twitter:description" content="序言最近我开始学习炙手可热的React，在浏览了官网的Get Started部分之后，我想动手写一写代码，这才发现官网并没有给出详细的环境搭建过程，而且我并不想使用官网提供的 boilerplate 项目Create React App。因此，我把这个过程记录下来，希望可以给新手们一点帮忙，这里并不介绍React相关的基础知识，只介绍环境的搭建过程。来，让我们从零开始，跟着贾思敏姐姐一步步搭建一个">
<meta name="twitter:image" content="https://s1.ax1x.com/2018/11/22/FPPChd.png">
  <!-- build:css css/screen.css -->

  <link rel="stylesheet" href="/css/screen.css">
  
  <!-- endbuild -->
  
  <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400" />
  <meta name="generator" content="Jasmine Yuan's Home">
  
  
  
</head>


<body class="post-template">

  <header class="main-header post-head no-cover" >
    <nav class="main-nav  clearfix">
        
        <a class="back-button icon-arrow-left" href="/">Home</a>
        <a class="subscribe-button icon-feed" href="/atom.xml">Subscribe</a>
    </nav>
    
    <a class="scroll-down icon-arrow-left" href="#content" data-offset="-45"><span class="hidden">Scroll Down</span></a>
</header>

  

<main id="content" class="content" role="main">
  <article class="post" itemprop="blogPost" itemscope="itemscope" itemtype="http://schema.org/BlogPosting">
    <header class="post-header">
      <h1 class="post-title" itemprop="name">从零开始学习React: 使用Yarn, Webpack和Babel来搭建环境</h1>
      <section class="post-meta">
  <time datetime="2017-03-06T21:26:51.000Z" itemprop="datePublished" class="post-date">
      2017-03-06
  </time>
  
  
  on 
  <a href='/tags/Programming/'>Programming</a>,
  
  <a href='/tags/JavaScript/'>JavaScript</a>,
  
  <a href='/tags/React/'>React</a>
  
  
</section>

    </header>
    <section class="post-content" itemprop="description articleBody">
      

      
      <section class="post-updated">
  Last updated on <time datetime="2018-11-21T18:32:41.403Z" itemprop="dateModified">
      2018-11-21
  </time>
</section>

      
      <h3 id="序言"><a href="#序言" class="headerlink" title="序言"></a>序言</h3><p>最近我开始学习炙手可热的<a href="https://facebook.github.io/react/" target="_blank" rel="external">React</a>，在浏览了官网的<a href="https://facebook.github.io/react/docs/hello-world.html" target="_blank" rel="external">Get Started</a>部分之后，我想动手写一写代码，这才发现官网并没有给出详细的环境搭建过程，而且我并不想使用官网提供的 boilerplate 项目<a href="https://github.com/facebookincubator/create-react-app" target="_blank" rel="external">Create React App</a>。因此，我把这个过程记录下来，希望可以给新手们一点帮忙，这里并不介绍<code>React</code>相关的基础知识，只介绍环境的搭建过程。来，让我们从零开始，跟着贾思敏姐姐一步步搭建一个<code>Hello Jasmine</code>的<code>React</code>项目。</p>
<h3 id="创建项目目录"><a href="#创建项目目录" class="headerlink" title="创建项目目录"></a>创建项目目录</h3><p>在安装后<code>Git</code>后，为项目新建一个目录，并初始化 git。</p>
<pre><code>mkdir into-react
cd into-react
git init
</code></pre><h3 id="跟着急性子的我先写-Hello-Jasmine"><a href="#跟着急性子的我先写-Hello-Jasmine" class="headerlink" title="跟着急性子的我先写 Hello Jasmine"></a>跟着急性子的我先写 Hello Jasmine</h3><p>急性子的我，已经等不及想写点<code>React</code>代码了，我怕一步步部署好<code>webpack</code>，写好<code>.babelrc</code>等等之后，热情就没了，所以让我们先来写这个神奇的<code>jsx</code>文件，并命名为<code>index.jsx</code>。</p>
<pre><code>import React from &apos;react&apos;;
import ReactDOM from &apos;react-dom&apos;;

ReactDOM.render(

      &lt;h1&gt;Hello, Jasmine!&lt;/h1&gt;,
      document.getElementById(&apos;root&apos;)
);
</code></pre><p>写完这个文件时候，我们肯定是希望把它放进浏览器里面展示出来，那么可能的问题有以下几种：</p>
<ul>
<li>还没有<code>HTML</code>文件，也还没有<code>id</code>为<code>root</code>的元素</li>
<li>怎么把<code>jsx</code>文件放进<code>HTML</code>页面?</li>
<li><code>import</code>这个高端的语法没见过?</li>
<li><code>react</code>和<code>react-dom</code>还没有安装，怎么<code>import</code>?</li>
</ul>
<p>让我们一个个问题来解决。</p>
<h3 id="新建-HTML-文件"><a href="#新建-HTML-文件" class="headerlink" title="新建 HTML 文件"></a>新建 HTML 文件</h3><p>首先，让我们新建包含<code>id</code>为<code>root</code>元素的<code>index.html</code>, 内容为：</p>
<pre><code>&lt;html&gt;
    &lt;head&gt;
        &lt;meta charset=&quot;utf-8&quot;&gt;
        &lt;title&gt;Into React&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;div id=&quot;root&quot;&gt;&lt;/div&gt;
    &lt;/body&gt;
    &lt;/html&gt;
</code></pre><h3 id="使用-Webpack-把需要的资源文件打包"><a href="#使用-Webpack-把需要的资源文件打包" class="headerlink" title="使用 Webpack 把需要的资源文件打包"></a>使用 Webpack 把需要的资源文件打包</h3><p>接下来的问题就是，<code>index.jsx</code>中使用了<code>react</code>和<code>react-dom</code>，要让<code>index.jsx</code>运行起来，我们的页面中需要包含<code>react</code>和<code>react-dom</code>。我们使用<code>Webpack</code>来把所有内容打包到<code>bundle.js</code>，然后在<code>index.html</code>中添加<code>bundle.js</code>。首先，使用<code>yarn init</code>初始化项目（可以一路回车完成配置），然后使用<code>yarn</code>在项目中安装<code>Webpack</code>。然后我们把<code>node_modules</code>放进<code>.gitignore</code>中。</p>
<pre><code>yarn init
yarn add webpack --dev
touch webpack.config.js
</code></pre><p><code>webpack.config.js</code>的内容为：<br>var BUILD_DIR = path.resolve(<strong>dirname, ‘src/client/public’);<br>var APP_DIR = path.resolve(</strong>dirname, ‘src/client/app’);</p>
<pre><code>var config = {
    entry: APP_DIR + &apos;/index.jsx&apos;,
    output: {
        path: BUILD_DIR,
        filename: &apos;bundle.js&apos;
    }
};

module.exports = config;
</code></pre><p>我们顺便调整了一下项目目录结构，将所有代码相关文件都放进<code>src</code>目录下的<code>client</code>文件夹中。其中<code>app</code>文件夹放源文件，<code>public</code>文件夹里面放打包后的<code>bundle.js</code>文件。<br>然后，我们把下面一行添加到<code>index.html</code>文件里面：</p>
<pre><code>&lt;script src=&quot;public/bundle.js&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;
</code></pre><p>有热心网友遇到了以下错误：</p>
<p><img src="https://s1.ax1x.com/2018/11/22/FPPChd.png" width="600px"></p>
<p>原因是把<code>bundle.js</code>放在了<code>head</code>里面，最好是放在<code>body</code>最下面，确保这个时候<code>DOM</code>里面已经有<code>id</code>为<code>root</code>的<code>div</code>了。如果一定想放在<code>head</code>里面，可以在<code>script</code>里面加一个<code>defer</code>的 attribute。</p>
<script src="public/bundle.js" defer type="text/javascript"></script>

<p><code>defer</code>可以保证该<code>js</code>在<code>HTML</code>解析完成后，再进行执行。当然了，也可以把<code>ReactDOM.render</code>放进<code>$(document).ready()</code>里面。<code>defer</code>和<code>async</code>还有不加的区别可以参考<a href="http://www.growingwiththeweb.com/2014/02/async-vs-defer-attributes.html" target="_blank" rel="external">这篇文章</a>。</p>
<p>当前我们的项目结构如下：</p>
<p><img src="https://s1.ax1x.com/2018/11/22/FPCHh9.png" width="200px"></p>
<h3 id="使用-Babel-转换-ES2015-语法和-JSX"><a href="#使用-Babel-转换-ES2015-语法和-JSX" class="headerlink" title="使用 Babel 转换 ES2015 语法和 JSX"></a>使用 Babel 转换 ES2015 语法和 JSX</h3><p>当我们使用<code>webpack webpack.config.js</code>来生成<code>bundle.js</code>时，我们发现会报错：</p>
<pre><code>Unexpected token (5:4)
You may need an appropriate loader to handle this file type.
</code></pre><p>就是说<code>webpack</code>不认识<code>jsx</code>文件，我们需要对应的<code>loader</code>让<code>webpack</code>认识它。这时我们就需要<code>Babel</code>了。 首先我们安装<code>babel-loader</code>，让<code>babel</code>来处理所有<code>jsx</code>文件。</p>
<pre><code>yarn add babel-loader --dev
</code></pre><p>在添加的时候我们发现有个 warning：</p>
<pre><code>warning &quot;babel-loader@6.3.2&quot; has unmet peer dependency &quot;babel-core@^6.0.0&quot;.
</code></pre><p>因此我们还需要安装<code>babel-core</code>。</p>
<pre><code>yarn add babel-core --dev
</code></pre><p>然后我们就需要挑选合适的<code>babel</code>插件来转换我们的<code>index.jsx</code>文件。我们仔细来看这个文件，发现首先<code>import</code>了<code>react</code>和<code>react-dom</code>。首先，按照官网<a href="https://facebook.github.io/react/docs/installation.html" target="_blank" rel="external">Installation</a>的介绍，我们安装 React 和 React-dom。使用 Yarn 安装:<br>yarn add react react-dom<br>接下来，什么是<code>import</code>？<code>import</code>其实是 ES2015 中引进的新语法，ES2015 引入了<code>class</code>的概念，关于 ES2015 的简单了解可以参考<a href="http://es6.ruanyifeng.com/" target="_blank" rel="external"><ecmascript6 入门=""></ecmascript6></a>。那么，为了让各种浏览器能够理解<code>import</code>，我们需要将它转换成 ECMAScript 5 的语法。这里，我们就需要用到<code>preset-es2015</code>这个插件。而为了让转化<code>jsx</code>语法，我们还需要使用<code>preset-react</code>。<br>yarn add babel-preset-react babel-preset-es2015 –dev</p>
<p>再修改我们的<code>webpack.config.js</code>文件:</p>
<pre><code>var webpack = require(&apos;webpack&apos;);
var path = require(&apos;path&apos;);

var BUILD_DIR = path.resolve(__dirname, &apos;src/client/public&apos;);
var APP_DIR = path.resolve(__dirname, &apos;src/client/app&apos;);

var config = {
    entry: APP_DIR + &apos;/index.jsx&apos;,
    output: {
        path: BUILD_DIR,
        filename: &apos;bundle.js&apos;
    },
    module: {
        loaders: [
            {
                test: /\.jsx?/,
                include: APP_DIR,
                loader: &apos;babel-loader&apos;
            }
        ]
</code></pre><p>}<br>};</p>
<pre><code>module.exports = config;
</code></pre><p>这个时候使用<code>webpack</code>来编译项目，发现如下错误：</p>
<p><img src="https://s1.ax1x.com/2018/11/22/FPCTk4.png" width="600px"></p>
<p>我们虽然指定了<code>babel-loader</code>来处理<code>jsx</code>文件，也安装了转换文件所需要的<code>babel-es2015</code>和<code>babel-react</code>，但我们在项目里并没有指定用这两个插件。因此，我们在根目录下添加<code>.babelrc</code>文件：</p>
<pre><code>{
&quot;presets&quot;: [&quot;react&quot;, &quot;es2015&quot;]
}
</code></pre><p><code>babel-loader</code>会自动去读这个文件，再次运行<code>webpack</code>，我们发现 build 已经成功了。</p>
<h3 id="部署服务器来看我们的-Hello！"><a href="#部署服务器来看我们的-Hello！" class="headerlink" title="部署服务器来看我们的 Hello！"></a>部署服务器来看我们的 Hello！</h3><p>现在离看到我们的页面只差一步了，就是起一个服务器。我们安装<code>webpack-dev-server</code>来启动并<code>watch</code>项目，这样当你修改代码的时候，就可以自动编译并显示在浏览器上。</p>
<pre><code>yarn add webpack-dev-server --dev
</code></pre><p>可以使用</p>
<pre><code>node_modules/.bin/webpack-dev-server --content-base src/client
</code></pre><p>来启动服务器。也可以把它作为一个<code>script</code>加到<code>package.json</code>里面：</p>
<pre><code>&quot;scripts&quot;: {
    &quot;dev&quot;: &quot;node_modules/.bin/webpack-dev-server --content-base src/client&quot;
</code></pre><p>}<br>这样只要运行<code>yarn run dev</code>，打开<code>localhost:8080</code>就能看到页面了！</p>
<p><img src="https://s1.ax1x.com/2018/11/22/FPCI7F.png" width="250px"></p>
<p>我们热心的网友又发现了一个问题，就是当前的页面在修改<code>index.jsx</code>后，虽然 console 里面显示了编译成功，但浏览器里面的内容并没有发生变化，就算手动刷新页面，新的内容也不会上去。这是为什么呢？因为<code>webpack-dev-server</code>在重新编译文件后，只是把新文件放在内存里，文件系统里的还是原来编译的，手动刷新，加载的是文件系统里的原来的文件，因此内容不会上去。这时候我们需要用到一个叫<a href="https://github.com/webpack/docs/wiki/configuration#outputpublicpath" target="_blank" rel="external"><code>publicPath</code></a>的属性，这个属性在<code>webpack</code>中的作用其实是为静态资源加上路径（有时候我们会把静态资源放到比如 cdn 的地方，这时候只需要设置<code>publicPath</code>，就可以在编译的时候统一修改。但对于<code>webpack-dev-server</code>而言，这个选项规定了本地服务器把哪个文件夹的内容 serve 到内存里。</p>
<blockquote>
<p>From <a href="webpack.github.io/docs/configuration.html#output-publicpath">this</a>, it seems this option tells webpack to fill in the correct url or path of assets in the generated files, not just for middlewares. When running dev server, I think the middleware looks at publichPath to hijack requests and return the in-memory files</p>
</blockquote>
<p>因此我们修改<code>webpack.config.js</code>的<code>output</code>如下：</p>
<pre><code>output: {
    path: BUILD_DIR,
    filename: &apos;bundle.js&apos;,
    publicPath: &apos;/public/&apos;
}
</code></pre>
    </section>
    <footer class="post-footer">
      <section class="author">
    <h4>Jasmine Yuan</h4>
    <p>A JavaScript Developer, A Cat Owner</p>
    
    <div class="author-meta">
      <span class="author-location icon-location">Vancouver, Canada</span>
      <span class="author-link icon-link"><a href="jasmineyuan.com">jasmineyuan.com</a></span>
    
      <section>
        
          <a href="https://twitter.com/YtJasmine" class="author-social">twitter</a>
        
          <a href="https://plus.google.com/u/1/108040574954055567249" class="author-social">google+</a>
        
          <a href="https://github.com/yuanting0505" class="author-social">github</a>
        
      </section>
    </div>
</section>

      <section class="share">
    <h4>Share this post</h4>
    <a class="icon-twitter" href="http://twitter.com/share?url=jasmineyuan.com/2017/03/06/Set-Up-React-Env/"
       onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
        <span class="hidden">Twitter</span>
    </a>
    <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=jasmineyuan.com/2017/03/06/Set-Up-React-Env/"
       onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
        <span class="hidden">Facebook</span>
    </a>
    <a class="icon-google-plus" href="https://plus.google.com/share?url=jasmineyuan.com/2017/03/06/Set-Up-React-Env/"
       onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
        <span class="hidden">Google+</span>
    </a>
</section>
    </footer>
  </article>
  <nav class="pagination" role="pagination">
  
  <a class="newer-posts" href="/2018/01/08/有一只猫叫狗蛋/" title="有一只猫叫狗蛋">
    ← Newer Post
  </a>
  
  <span class="page-number">•</span>
  
</nav>

  
<div id="comment" class="comments-area">
    <h2 class="title"><a href="#disqus_comments" name="disqus_comments">Comments</a></h2>
    <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>
    
</div>

</main>


  <footer class="site-footer clearfix">
 <section class="copyright"><a href="/">Jasmine Yuan's Home</a> &copy; 2015 &bull; All rights reserved.</section>
 <section class="poweredby">Proudly published with <a class="icon-ghost" href="http://zespia.tw/hexo/"> Hexo</a></section>
</footer>

  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="js/jquery-2.0.3.min.js"><\/script>')</script>

<script type="text/javascript" src="/js/index.js"></script>




<script type="text/javascript">
    var disqus_shortname = 'jasmineyuan';
    (function(){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>


</body>
</html>
